<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="description" content="Ajuda">
  <meta name="keywords" content="HTML,CSS,XML,JavaScript">
  <meta name="author" content="Erick Weil">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Portugol Web</title>
	<link rel="stylesheet" type="text/css" href="portugol.css">
</head>
<body style="margin:0">
<!--<div id="EditorContainer" style="position:relative;width:100%;height:500px;margin:0;padding:0;overflow:none">-->
<!--

o que falta:
- tratar erros de execução:
	- no leia quando entrada não é válida
	- de divisão por zero
	
- escolha-caso
- vetores e matrizes
- passar argumentos por referência
- passar vetores e matrizes como argumentos

Portugol web no celular
- Utilização:
	- Executar como um bottomsheetdialog
	- porcentagem na barra de caracteres
	- Perguntar antes de sair( ao recarregar a página por exemplo )
	- Selecionar o texto não funciona no celular
	- Editor não utiliza espaçamentos com TAB por padrão.

- Exibição de erros:
	- retorne em função sem retorno, exibir erro correto
	- Utilizar uma variável que não é vetor como vetor apresenta undefined dimensões



- Bibliotecas

	funcao hhh()
	{
		inteiro a
		escreva("insira um valor:")
		leia(a)
		escreva("você inseriu:"+a+"\n\n")
		inteiro v
		//          5 * 5 + 2 * 3, ... (5 * 5) + (2 * 3) = 25 + 6 = 31
		v = 5 * 5 + 2 * 3
		escreva(v+" == 31\n")
		//           1 - - 1, ... 1 - (-1) = 2
		v = 1 - - 1
		escreva(v+" == 2\n")
		//           -1 + 1,  ... (-1) + 1 = 0
		v = -1 + 1
		escreva(v+" == 0\n")
		//           - -1 + 1,  ... (-(-1)) + 1 = 2
		v = - -1 + 1
		escreva(v+" == 2\n")
		//          - - -1 + 1,  ... (-(-(-1))) + 1 = 0
		v = - - -1 + 1
		escreva(v+" == 0\n")
		//   2 * 2 * 2 + 1 ... (2 * (2 * 2)) + 1 = 9
		v = 2 * 2 * 2 + 1
		escreva(v+" == 9\n")
		
		//  -a++ = -(a++)
		v = 1
		v = -v++
		escreva(v+" == -2\n")
	}
-->
<div id="myEditor">/* Portugol Web desenvolvido por Erick Leonardo Weil
baseado no programa Portugol Studio.
*/
programa 
{
	funcao inicio()
	{
		// Seu código deve vir aqui.

		para(inteiro i =0;i<200;i++)
		escreva("Olá mundo"+i+" \n")
	}
}
</div>
<div id="myOutput" style="position:relative;">
<div class="portugol-buttons">
<input type="button" id="btn-run" value="Executar" onclick="executar(this)"/>

<input type="button" style="background-image: url(icons/FontPlus.png);" id="btn-fonteMaior" value=" " onclick="fonteAumentar()"/>
<input type="button" style="background-image: url(icons/FontMinus.png);" id="btn-fonteMenor" value=" " onclick="fonteDiminuir()"/>
<input type="button" style="background-image: url(icons/save.png);" id="btn-salvar" value=" " onclick="save()"/>
<input type="button" style="background-image: url(icons/open.png);"  id="btn-abrir" value=" " onclick="load()"/>
<input type="button" style="background-image: url(icons/full.png);" id="btn-abrir" value=" " onclick="requestFullScreen(document.documentElement);"/>
<!--<input type="button" id="btn-execErros" value="Ignorar Erros" onclick="check_execErros()"/>-->
</div>
<div class="saida" id="saida"><div id="errorArea"></div><textarea id="textAreaSaida" onclick="cursorToEnd(this)" onkeyup="cursorToEnd(this)" oninput="receiveInput(this)">??</textarea></div>
<div class="saida" id="hidden"></div>
<!--<input type="button" value="mostrar bytecode" style="position:absolute;top:0px;right:0px;background:transparent;z-index: 5;border:none" onclick="document.getElementById('hidden').style.display = 'block';"/>-->
</div>
<!-- Canvas modo Gráfico -->
<div id="myCanvasModal">
<div id="myCanvasWindow">
<input type="button" value="Janela Sem Titulo" style="float:left;background: #1E2324;" id="myCanvasWindowTitle"/>
<input type="button" value="X" style="float:right;background: #1E2324;" onclick="executar(document.getElementById('btn-run'));"/>
<canvas id="myCanvas" width="100" height="100"></canvas>
</div>
</div>

<div id="hotbar" class="portugol-buttons" style="width:100%">
<div style="overflow-x:scroll;white-space:nowrap;width: auto;">
<input type="button" value="(" onclick="editorType('(')" onfocus="preventFocus(event)"/>
<input type="button" value=")" onclick="editorType(')')" onfocus="preventFocus(event)"/>
<input type="button" value='"' onclick="editorType('&quot;')" onfocus="preventFocus(event)"/>
<input type="button" value="=" onclick='editorType("=")' onfocus="preventFocus(event)"/>
<input type="button" value="+" onclick='editorType("+")' onfocus="preventFocus(event)"/>
<input type="button" value="-" onclick='editorType("-")' onfocus="preventFocus(event)"/>
<input type="button" value="*" onclick='editorType("*")' onfocus="preventFocus(event)"/>
<input type="button" value="/" onclick='editorType("/")' onfocus="preventFocus(event)"/>
<input type="button" value="{" onclick="editorType('{')" onfocus="preventFocus(event)"/>
<input type="button" value="}" onclick="editorType('}')" onfocus="preventFocus(event)"/>
<input type="button" value=">" onclick='editorType(">")' onfocus="preventFocus(event)"/>
<input type="button" value="<" onclick='editorType("<")' onfocus="preventFocus(event)"/>
<input type="button" value="!" onclick='editorType("!")' onfocus="preventFocus(event)"/>
<input type="button" value="\" onclick="editorType('\\')" onfocus="preventFocus(event)"/>
<input type="button" value="[" onclick="editorType('[')" onfocus="preventFocus(event)"/>
<input type="button" value="]" onclick="editorType(']')" onfocus="preventFocus(event)"/>
<input type="button" value=";" onclick='editorType(";")' onfocus="preventFocus(event)"/>
</div>
<div style="overflow-x:scroll;white-space:nowrap;width: auto;">
<input type="button" value="TAB" onclick="editorType('\t')" onfocus="preventFocus(event)"/>
<input type="button" style="background-image: url(icons/arrowL.png);" value=" " onclick="editorMove(-1,0)" onfocus="preventFocus(event)"/>
<input type="button" style="background-image: url(icons/arrowR.png);" value=" " onclick="editorMove(1,0)" onfocus="preventFocus(event)"/>
<input type="button" style="background-image: url(icons/arrowU.png);" value=" " onclick="editorMove(0,-1)" onfocus="preventFocus(event)"/>
<input type="button" style="background-image: url(icons/arrowD.png);" value=" " onclick="editorMove(0,1)" onfocus="preventFocus(event)"/>
<input type="button" value="DEL" onclick="editorDelete()" onfocus="preventFocus(event)"/>
</div>
</div>

<script src="tokenizer.js"></script> <!-- Quebra o texto [para, , tokens, certinho]-->
<script src="parser.js"></script> <!-- pega os tokens e constroi a árvore -->

<!-- Bibliotecas -->
<script src="libraries/Util.js"></script>
<script src="libraries/Matematica.js"></script>
<script src="libraries/Texto.js"></script>
<script src="libraries/Graficos.js"></script>

<script src="vm.js"></script> <!-- executa o 'bytecode' -->
<script src="vmcompiler.js"></script> <!-- compila a árvore em 'bytecode' ( parecido com java só que não é java ) -->

<!--<script src="treeview.js"></script>< ! - -  para visuzalizar a árvore -->
<script src="src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>

<script src="ace_portugol.js"></script>
<script>


	function isMobile() // https://stackoverflow.com/questions/11381673/detecting-a-mobile-browser
	{
		var check = false;
		(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
		return check;
	}
	
	/* View in fullscreen */
	function requestFullScreen(element) {
		// Supports most browsers and their versions.
		var requestMethod = element.requestFullScreen || element.webkitRequestFullScreen || element.mozRequestFullScreen || element.msRequestFullScreen;

		if (requestMethod) { // Native full screen.
			requestMethod.call(element);
		} else if (typeof window.ActiveXObject !== "undefined") { // Older IE.
			var wscript = new ActiveXObject("WScript.Shell");
			if (wscript !== null) {
				wscript.SendKeys("{F11}");
			}
		}
	}
	//var codigo = document.getElementById("myEditor");
	var saida = document.getElementById("textAreaSaida");
	var errosSaida =document.getElementById("errorArea");
//for( var i = 0;i< codigos.length;i++)
//{
	//var div_port = codigo;
	var div_saida = saida;
	
	var myCanvasModal = document.getElementById("myCanvasModal");
	var myCanvasWindow = document.getElementById("myCanvasWindow");
	var myCanvasWindowTitle = document.getElementById("myCanvasWindowTitle");
	var myCanvas = document.getElementById("myCanvas");
	//var string_cod = decodeEntities(div_port.innerHTML);
	var fontSize = 10;
	
	var isMobile = isMobile();
	var hotbar = document.getElementById("hotbar");
    var hotbar_currentY;
    var hotbar_initialY;
	var hotbar_clickY;
	var hotbar_maxyOffset = 180;
	var hotbar_collapsedyOffset = 120;
	var hotbar_middleyOffset = 80;
	var hotbar_extendedyOffset = 0;
	var hotbar_minyOffset = -180;
    var hotbar_yOffset = hotbar_collapsedyOffset;
	var hotbar_active = false;
	var hotbar_textarea = false;
	
	if(isMobile)
	{
		hotbar.style.display = "block";
		hotbar.addEventListener("touchstart", hotbar_dragStart, false);
		hotbar.addEventListener("touchend", hotbar_dragEnd, false);
		hotbar.addEventListener("touchmove", hotbar_drag, false);
		
		var myOutput = document.getElementById("myOutput");
		myOutput.style.height = "120px";
		hotbar.appendChild(myOutput);
		
		setHotbarPosition(hotbar_middleyOffset);
	}
	else
	{
		hotbar.style.display = "none";
	}
	


	
	if(isMobile) {
		fontSize = 9;
	}
    var editor = ace.edit("myEditor",{
			minLines: 10,
			fontSize: fontSize+"pt"
		}
	);
    editor.setTheme("ace/theme/portugol_dark");
    editor.session.setMode("ace/mode/portugol");
	if(isMobile) {
		editor.renderer.setShowGutter(false);
	}
	
			
	div_saida.style.fontSize = fontSize+"pt";
	errosSaida.style.fontSize = fontSize+"pt";
	

	
	var errosAnnot = [];
	var errosMarkers = [];
	
	var Range = ace.require("ace/range").Range;

	function save() {
		var string_cod = editor.getValue();
		tring_cod = string_cod.replace(/\r\n/g,"\n");
		
		var element = document.createElement('a');
		element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(string_cod));
		element.setAttribute('download', 'programa.por');

		element.style.display = 'none';
		document.body.appendChild(element);

		element.click();

		document.body.removeChild(element);
	}

	function load() {
		var element = document.createElement('input');
		element.setAttribute('type', 'file');

		element.style.display = 'none';
		document.body.appendChild(element);

		element.click();
		
		element.addEventListener('change', function(){
			var file = element.files[0];

			var reader = new FileReader();
			reader.onload = function(progressEvent)
			{
				editor.setValue(this.result, -1); // moves cursor to the start
				
				limparErros();
			};
			reader.readAsText(file);
			document.body.removeChild(element);
		});
	}
	
	function limparErros()
	{
		errosSaida.innerHTML = "";
		errosAnnot = [];
		editor.getSession().setAnnotations(errosAnnot);
		for(var i=0;i<errosMarkers.length;i++)
		{
			editor.getSession().removeMarker(errosMarkers[i]);
		}
		errosMarkers = [];
	}
	
	function enviarErro(textInput,token,msg)
	{
		var lineNumber = numberOfLinesUntil(token.index,textInput);
		var prev_line = textInput.substring(textInput.lastIndexOf('\n', token.index)+1,token.index).replace(/\t/g,'    ');
		var next_line = textInput.substring(token.index,textInput.indexOf('\n', token.index));
		var colNumber = prev_line.length;
		var logprev = "Linha "+lineNumber+":"+prev_line;
		
		try {
			ERRO();
		} catch (e) {
			var myStackTrace = e.stack || e.stacktrace || "";
			
			console.log(myStackTrace);
		}
		
		console.log(msg);
		_enviarErro(lineNumber,colNumber,colNumber+next_line.length,msg);
		errosSaida.innerHTML += htmlEntities(msg)+"\n";
		errosSaida.innerHTML += htmlEntities(logprev+next_line)+"\n";
		errosSaida.innerHTML += " ".repeat(logprev.length)+"^\n\n";
	}
	
	function _enviarErro(linha,coluna,colunaFim,msg)
	{
		errosAnnot.push({
		  row: linha-1,
		  column: coluna,
		  text: msg, // Or the Json reply from the parser 
		  type: "error" // also warning and information
		});
		editor.getSession().setAnnotations(errosAnnot);
		
		errosMarkers.push(editor.getSession().addMarker(new Range(linha-1, 0, linha-1, colunaFim), 'ace_erroportugol-marker', 'screenLine'));
	}
	
	function cursorToEnd(textarea)
	{
		var txtEnd =textarea.value.length;
		textarea.selectionStart= txtEnd;
		textarea.selectionEnd= txtEnd;
	}
	
	function fonteAumentar()
	{
		fontSize++;
		editor.setOptions({
		  fontSize: fontSize+"pt"
		});
		
		div_saida.style.fontSize = fontSize+"pt";
		errosSaida.style.fontSize = fontSize+"pt";
	}
	
	function fonteDiminuir()
	{
		fontSize--;
		editor.setOptions({
		  fontSize: fontSize+"pt"
		});
		
		div_saida.style.fontSize = fontSize+"pt";
		errosSaida.style.fontSize = fontSize+"pt";
	}
	
	var execMesmoComErros = false;
	function check_execErros()
	{
		// Get the checkbox
		var btn = document.getElementById("btn-execErros");

		// If the checkbox is checked, display the output text
		execMesmoComErros = !execMesmoComErros;
		if(!execMesmoComErros)
			btn.value = "Ignorar Erros";
		else
			btn.value = "Parar em Erros";
	}
	
	//alert(string_cod);
	//div_port.innerHTML = token_replace(string_cod);
	/*function executar()
	{
		limparErros();
		var string_cod = editor.getValue();
		
		var tokenizer = new Tokenizer(string_cod);
		console.log(tokenizer.tokenize());
		
		//div_port.innerHTML = tokenizer.formatHTML();
		
		var relevantTokens = tokenizer.getRelevantTokens();
		var tree = new Parser(relevantTokens,string_cod).parse();
		console.log(tree.funcoes[0].statements);
		
		var interpreter = new Interpreter(tree,relevantTokens,string_cod,div_saida);
		interpreter.run();
	}*/
	
	//var lastvm = false;
	var lastvmState = STATE_ENDED;
	var lastvmTime = 0;
	function executar(btn)
	{
		if(btn.value == "Executar" && lastvmState == STATE_ENDED)
		{
			limparErros();
			limpa();
			
			// abrir hotbar e animar
			if(isMobile)
			{
				setHotbarPosition(hotbar_extendedyOffset,true);
			}
			
			var string_cod = editor.getValue();
			try{
				
				
				string_cod = string_cod.replace(/\r\n/g,"\n");
				
				var tokenizer = new Tokenizer(string_cod);
				console.log(tokenizer.tokenize());
				if(!execMesmoComErros && errosAnnot.length > 0)
				{
					return;
				}
				//div_port.innerHTML = tokenizer.formatHTML();
				
				var relevantTokens = tokenizer.getRelevantTokens();
				var tree = new Parser(relevantTokens,string_cod).parse();
				console.log(tree);
				if(!execMesmoComErros && errosAnnot.length > 0)
				{
					return;
				}
				
				var libraries = {};
				libraries["Util"] = new Util();
				libraries["Matematica"] = new Matematica();
				libraries["Texto"] = new Texto();
				libraries["Graficos"] = new Graficos(myCanvas,myCanvasModal,myCanvasWindow,myCanvasWindowTitle);
				
				var compiler = new Compiler(tree,libraries,relevantTokens,string_cod,div_saida);
				compiler.compile();
				if(!execMesmoComErros && errosAnnot.length > 0)
				{
					return;
				}
				//lastvm = new Vm(compiler.functions,string_cod,div_saida);
				
				VMsetup(compiler.functions,libraries,compiler.globalCount,string_cod,div_saida);
				document.getElementById("hidden").innerHTML = VMtoString();
				//lastvmState = lastvm.run();
				lastvmTime = performance.now();
				
			}
			catch(err)
			{
				//console.log(err.stack);
				enviarErro(string_cod,{index:0},"Erro na compilação:"+err);
				return;
			}
			
			btn.value = "Parar";
			executarVM();
		}
		else if(btn.value == "Parar" && (lastvmState == STATE_RUNNING || lastvmState == STATE_WAITINGINPUT || lastvmState == STATE_BREATHING || lastvmState == STATE_DELAY))
		{
			btn.value = "Parando...";
			if(lastvmState == STATE_WAITINGINPUT)
			{
				escreva("\n\nPrograma interrompido pelo usuário. Tempo de execução:"+Math.trunc(performance.now()-lastvmTime)+" milissegundos");
				executarParou();
			}
			else if(lastvmState == STATE_RUNNING || lastvmState == STATE_BREATHING || lastvmState == STATE_DELAY)
			{
				lastvmState = STATE_PENDINGSTOP;
			}
			else
			{
				console.log("botão estava em estado inconsistente: lastvmState:'"+lastvmState+"' e valor:'"+btn.value+"'");
			}
		}
		else if(btn.value == "Parando..." && lastvmState == STATE_PENDINGSTOP)
		{
			// ta idaí?
			lastvmState = STATE_PENDINGSTOP; // só para confirmar
		}
		else // para deixar o botao do jeito certo, e corrigir no caso de algum erro.
		{
			console.log("botão estava em estado inconsistente: lastvmState:'"+lastvmState+"' e valor:'"+btn.value+"'");
			if(lastvmState == STATE_ENDED) btn.value = "Executar";
			else if(lastvmState == STATE_PENDINGSTOP) btn.value = "Parando...";
			else btn.value = "Parar";
		}
	}
	
	function executarParou()
	{
		lastvmState = STATE_ENDED;
		document.getElementById("btn-run").value = "Executar";
		myCanvasModal.style.display = "none";
	}
	
	function executarVM()
	{
		if(lastvmState == STATE_PENDINGSTOP) {
			// blz então
			escreva("\n\nPrograma interrompido pelo usuário. Tempo de execução:"+Math.trunc(performance.now()-lastvmTime)+" milissegundos");
			executarParou();
			return;
		}
		lastvmState = STATE_RUNNING;
		lastvmState = VMrun();
		//VM_saidaDiv.value = VM_saida;
		if(lastvmState == STATE_ENDED)
		{
			escreva("\n\nPrograma finalizado. Tempo de execução:"+Math.trunc(performance.now()-lastvmTime)+" milissegundos");
			executarParou();
		}
		else if(lastvmState == STATE_WAITINGINPUT) {
			div_saida.focus();
			cursorToEnd(div_saida);
		}
		else if(lastvmState == STATE_BREATHING) {
			setTimeout(executarVM, 0); // permite o navegador ficar responsivo
		}
		else if(lastvmState == STATE_DELAY) {
			setTimeout(executarVM, VM_delay);
		}
	}
	
	function receiveInput(textarea)
	{
		if(lastvmState == STATE_WAITINGINPUT)
		{
			var saidadiv = textarea.value;
			var entrada = saidadiv.substring(VM_saida.length,saidadiv.length);
			
			if(entrada.endsWith("\n"))
			{
				executarVM();
			}
		}
		else
		{
			div_saida.value = VM_saida;
		}
	}
	
	function editorFocus()
	{
		if(isMobile)
		{
			//document.getElementById("hotbar").style.display = "block";
			setHotbarPosition(hotbar_middleyOffset,true);
		}
	}
	
	function preventFocus(event) {
		event.preventDefault();
		event.stopPropagation();
		/*if (event.relatedTarget) {
			// Revert focus back to previous blurring element
			event.relatedTarget.focus();
		} else {
			// No previous focus target, blur instead
			event.currentTarget.blur();
		}*/
		editor.focus();
	}
	
	/*function editorBlur()
	{
		if(isMobile)
		{
			document.getElementById("hotbar").style.display = "none";
		}
	}*/	
	
	function editorType(c)
	{
		isTyping = true;
		editor.getSession().insert(editor.getCursorPosition(), c);
		editor.focus();
	}
	
	function editorMove(column,row)
	{
		editor.gotoLine((editor.getCursorPosition().row+1) + row, editor.getCursorPosition().column + column); 
	}
	
	function editorDelete()
	{
		var p = editor.getCursorPosition();
		editor.getSession().replace(new Range(p.row, p.column, p.row, p.column+1), "");
	}
	
	editor.on("focus", editorFocus);
	//editor.on("blur", editorBlur);
	
	// HOTBAR
	
	function hideHotBarWhenLandscape()
	{
		if(isMobile)
		{
			var w = document.documentElement.clientWidth;
			var h = document.documentElement.clientHeight;
			
			//if(h < 40*2 + 200)
			if(w > h*1.5)
			{
				document.getElementById("hotbar").style.display = "none";
			}
			else
			{
				document.getElementById("hotbar").style.display = "block";
			}
		}
	}
	
	function hotbar_dragStart(e) {
		var yValue = 0;
		if (e.type === "touchstart") {
			yValue = e.touches[0].clientY;
		} else {
			yValue = e.clientY;
		}
		
		hotbar_clickY = yValue;
		hotbar_initialY = yValue - hotbar_yOffset;

		if (e.target === hotbar) {
			hotbar_active = true;
		}
		else if(e.target === saida)
		{
			hotbar_textarea = true;
		}
    }

    function hotbar_dragEnd(e) {
		//initialX = currentX;
		hotbar_initialY = hotbar_currentY;

		
		console.log(hotbar_yOffset);
		if(Math.abs(hotbar_yOffset - hotbar_extendedyOffset) < 30)
		{
			setHotbarPosition(hotbar_extendedyOffset,true);
		}
		else if(Math.abs(hotbar_yOffset - hotbar_middleyOffset) < 30)
		{
			setHotbarPosition(hotbar_middleyOffset,true);
		}
		else if(Math.abs(hotbar_yOffset - hotbar_collapsedyOffset) < 30)
		{
			setHotbarPosition(hotbar_collapsedyOffset,true);
		}


		hotbar_active = false;
		hotbar_textarea = false;
    }

    function hotbar_drag(e) {
		var yValue = 0
		if (e.type === "touchmove") {
			yValue = e.touches[0].clientY;
		} else {
			yValue = e.clientY;
		}
		
		hotbar_currentY = yValue - hotbar_initialY;
		var yOff = Math.abs(hotbar_clickY - yValue);
		//console.log("drag:"+yOff);
		
		
	
		if (!hotbar_active) {
		
			if(hotbar_textarea && !elementIsAllScrolled(saida))
			{
				hotbar_clickY = yValue;
				hotbar_initialY = yValue - hotbar_yOffset;
				return;
			}
		
			if(yOff < 20)
			{
				return;
			}
			else
			{
				hotbar_active = true;
			}
		}
		else
		{
			if(e.cancelable)
			{
				e.preventDefault();
			}
		}

		//xOffset = currentX;
		

		//setTranslate(hotbar_currentY, hotbar);
		setHotbarPosition(hotbar_currentY,false);
    }

    function setHotbarPosition(yPos,animate) {
		if(animate)
		{
			hotbar.classList.add('animate');
		}
		else
		{
			hotbar.classList.remove('animate');
		}
		//el.style.transform = "translate3d(0px,	  " + yPos + "px, 0)";
		hotbar_yOffset = Math.max(hotbar_minyOffset,Math.min(hotbar_maxyOffset,yPos));
		//hotbar_yOffset = Math.min(hotbar_maxyOffset,yPos);
		hotbar.style.bottom = (-hotbar_yOffset)+"px";
    }
	
	function elementIsAllScrolled(obj)
	{
		if( obj.scrollTop === (obj.scrollHeight - obj.offsetHeight))
		{
			return true;
		}
		if( obj.scrollTop === 0)
		{
			return true;
		}
		return false;
	}
	
	//https://stackoverflow.com/questions/821011/prevent-a-webpage-from-navigating-away-using-javascript
	window.onbeforeunload = function() {
	return "";
	}
	
	window.addEventListener("resize", hideHotBarWhenLandscape);
//}
</script>
<!--<script src="codetest.js"></script><!-- para testar -->
</html>